var LinkcircleRunner=function(){class i extends Error{code;message;cause;name="LinkcircleError";constructor(e,r,t){super(),this.code=e,this.message=r,this.cause=t}}function o(e){return[...document.querySelectorAll(e)].filter(e=>e instanceof HTMLElement)}function n(a,r=1/0){return new Promise(n=>{var e=o(a);if(0!==e.length)n(e);else{let t=new MutationObserver(e=>{var r=o(a);0!==r.length&&(n(r),t.disconnect())});t.observe(document,{childList:!0,subtree:!0}),r!==1/0&&setTimeout(()=>{n([]),t.disconnect()},r)}})}async function a(r=!0){var t=await n("html");for(let e=0;e<t.length;e++)t[e].style.display=r?"none":null}let s=!1;function l(e,...r){var t=console[e]??console.log;"debug"===e&&!s||t("[linkcircle]",...r)}function u(e,r){alert(`${r}

    ${location.href}
    `+e)}let c={cacheLifespan:18e5,storagePrefix:"linkcircle",hidePage:!0,showDebug:!1,dryRun:!1,showErrorMessage:!0,useImplicitUrl:!0,explicitUrlKey:"lc",slugAttributeName:"data-slug",hrefAttributeName:"href",memberSelector:"[href][data-slug]",memberNotFoundMessage:"Couldn't find a webring member. This could be an issue with the webring or a member's widget.",internalErrorMessage:"Internal Linkcircle error!",nextName:"next",previousName:"previous",randomName:"random"};function e(){var r,e=document.currentScript,t={...c};for(r of e.attributes){var{name:n,value:a}=r;if(n.startsWith("data-")){n=function(r){let t=!1,n="";for(let e=0;e<r.length;e++){var a=r[e];"-"===a?t=!0:t?(n+=a.toUpperCase(),t=!1):n+=a}return n}(n.slice(5));if(n in t)try{t[n]=JSON.parse(a)}catch(e){l("error","failed to parse option",r,e)}else l("warn","unknown option",r)}}return t}class r extends Array{}async function m(r){await("complete"===document.readyState?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>{e()})}));var e=(await n(r.memberSelector)).map(e=>new t(e.getAttribute(r.slugAttributeName),e.getAttribute(r.hrefAttributeName)));return new d(...e)}async function f(e,r){try{var t,n,a=JSON.parse(localStorage.getItem(r));return null==a?new d:(t=a.timestamp,(n=Date.now())<t||t+e<n?new d:d.fromSerialized(a.members))}catch(e){return l("warn","failed to read the cache",e),new d}}function h(e,r){e={members:e.toSerialized(),timestamp:Date.now()},localStorage.setItem(r,JSON.stringify(e))}class t{slug;url;constructor(e,r){this.slug=e;try{this.url=new URL(r,location.href)}catch(e){throw new i("invalid-url",`"${r}" is not a valid URL.`,e)}}toSerialized(){return JSON.stringify({url:this.url.toString(),slug:this.slug})}static fromSerialized(e){e=JSON.parse(e);return new t(e.slug,e.url)}}class d extends r{indexOfSlug(r){for(let e=0;e<this.length;e++)if(this[e].slug===r)return e;return-1}offsetFrom(e,r){e=this.indexOfSlug(e);return-1===e?null:this.at((e+r)%this.length)}random(){return this[e=0,r=this.length,e=Math.ceil(e),r=Math.floor(r)-1,Math.floor(Math.random()*(r-e+1)+e)];var e,r}randomFromMember(e){var r;return(1===this.length?this:(e=(r=new d(...this)).indexOfSlug(e),r.splice(e,1),r)).random()}toSerialized(){return JSON.stringify(this.map(e=>e.toSerialized()))}static fromSerialized(e){e=JSON.parse(e);return new d(...e.map(e=>t.fromSerialized(e)))}}var g,w;function p(e,r){var t,e=/^(.*)-(.*)$/.exec(e);return null==e?null:([,e,t]=e,null!=(t=function(e,r){switch(e){case r[g.Next]:return g.Next;case r[g.Previous]:return g.Previous;case r[g.Random]:return g.Random;default:return null}}(t,r))?[t,e]:void 0)}function b(e,r){var t=function(e,r){var t=[...e.searchParams.entries()];for(let e=0;e<t.length;e++){var n=t[e];if(!n[1]){n=p(n[0],r);if(n)return n}}return null}(e,r.urlActionMap),e=function(e,r="lc",t){e=e.searchParams.get(r);return e?p(e,t):null}(e,r.explicitKey,r.urlActionMap);return r.useImplicit?t??e:e}async function v(e){var r=new URL(location.toString()),t={explicitKey:e.explicitUrlKey,useImplicit:e.useImplicitUrl,urlActionMap:{[g.Next]:e.nextName,[g.Previous]:e.previousName,[g.Random]:e.randomName}},n=null!=b(r,t),n=(n&&e.hidePage&&a(!0),{hrefAttributeName:e.hrefAttributeName,memberSelector:e.memberSelector,slugAttributeName:e.slugAttributeName}),n=await async function(e,r,t){if(r=r+"-"+location.pathname,0<e){e=await f(e,r);if(0!==e.length)return e}return h(e=await m(t),r),e}(e.cacheLifespan,e.storagePrefix,n),r=(l("debug",n.map(e=>e.slug+" "+e.url)),function(e,r,t){if(!(e=b(e,t)))return null;var[t,n]=e;let a;switch(t){case g.Next:a=r.offsetFrom(n,1);break;case g.Previous:a=r.offsetFrom(n,-1);break;case g.Random:a=r.randomFromMember(n)}if(null==a)throw new i("slug-not-found",`No member exists with the slug "${n}". Make sure the spelling and capitalization matches.`);return a}(r,n,t));return!!r&&(l("debug","redirecting to",r.url.href),e.dryRun||location.replace(r.url),!0)}async function N(r){var e;e=r.showDebug,s=e,l("debug","main() called");let t=!1,n=null;try{t=await v(r)}catch(e){e instanceof i&&"slug-not-found"===e.code?l("debug","member not found"):(l("error",e),r.showErrorMessage&&u(e,r.internalErrorMessage),n=e)}if(t||(l("debug","re-running without cache"),await v({...r,cacheLifespan:0})),n)throw n}return(w=g=g||{})[w.Next=0]="Next",w[w.Previous=1]="Previous",w[w.Random=2]="Random",(async()=>{var r=e();try{await N(r)}catch(e){e instanceof i&&"slug-not-found"===e.code||(l("error",e),r.showErrorMessage&&u(e,r.internalErrorMessage)),r.hidePage&&a(!1)}})()}();
    